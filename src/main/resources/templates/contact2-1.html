<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Management System</title>
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <style>
    /* Navbar Custom Styles */
    .navbar-custom {
    background-color: #007bff;
    }
    .navbar-custom .navbar-brand,
    .navbar-custom .nav-link {
    color: white;
    }
    .navbar-custom .nav-link:hover {
    color: #f8f9fa;
    }

    /* Modal Custom Styles */
    .modal-dialog.modal-sm {
        max-width: 550px; /* Adjust as needed */
    }

    .modal-body {
        padding: 10px; /* Adjust padding if needed */
    }

    .form-control {
        border-radius: 0.25rem;
        margin-bottom: 7px; /* Space between fields */
    }
    /* Contact Card Styles */
    .contact-card {
    border: 1px solid #e3e3e3;
    border-radius: 0.25rem;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    text-align: left;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* Center image and other elements horizontally */
    }

    .contact-card img {
    border-radius: 50%;
    margin-bottom: 10px;
    width: 100px;
    height: 100px;
    }

    .contact-card h4 {
    text-align: center; /* Center the heading text */
    }

    .contact-card .btn-view {
    position: relative;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    }

    /* View Card Styles */
    .view-card img {
    border-radius: 50%;
    margin-bottom: 10px;
    width: 100px;
    height: 100px;
    }

    /* Modal Header Styles */
    .modal-header {
    background-color: #007bff;
    color: white;
    }

    /* Modal Footer Button Styles */
    .modal-footer .btn {
    margin: 0 5px;
    }

    /* Form Group Label Styles */
    .form-group label {
    font-weight: bold;
    }

    /* Success Modal Styles */
    #successModal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4); /* Black background with transparency */
    }

    /* Modal content box */
    #successModal .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    width: 300px;
    text-align: center;
     font-size: 18px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }


    /* Success message heading */
    #successModal h3 {
    color: #007bff;

    }

    /* Modal Button */
    #successModal #okButton {
    background-color: #45a049;
    padding: 10px 20px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 20px;
    }

    #successModal #okButton:hover {
    background-color: #007bff;
    }
    /* close Modal Styles */
    #closeModal {
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    /* close Modal content box */
    #closeModal .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        text-align: center;
        font-size: 18px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    /* close message heading */
    #closeModal h3 {
        color: #007bff;

    }

    /* close Modal Button */
    #closeModal #closeButton {
        background-color: red; /* Green */
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        margin-top: 20px;
    }

    #closeModal #closeButton:hover {
        background-color: #007bff;
    }
    /* Delete Modal Styles */
    #deleteModal {
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    /* close Modal content box */
    #deleteModal .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        text-align: center;
        font-size: 18px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }



    /* close message heading */
    #closeModal h3 {
        color: #007bff;

    }

    /* close Modal Button */
    #deleteModal #deleteButton {
        background-color: yellowgreen; /* Green */
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        margin-top: 20px;
    }

    #deleteModal #deleteButton:hover {
        background-color: #007bff;
    }
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-custom">
    <a class="navbar-brand" href="#">Contact Management</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#addContactModal">Add Contact</a>
            </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <select class="form-control mr-sm-2" id="searchSelect">
                <option value="name">Name</option>
                <option value="nickname">Nickname</option>
                <option value="email">Email</option>
                <option value="phone">Phone</option>
                <option value="birthday">Birthday</option>
                <option value="relationship">Relationship</option>
                <option value="address">Address</option>
            </select>
            <input class="form-control mr-sm-2" type="search" id="searchBox" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-light my-2 my-sm-0" type="button" onclick="searchContacts()">Search</button>
        </form>
    </div>
</nav>

<div class="container mt-4">
    <h2>Contact List</h2>
    <div class="row" id="contactList">
        <!-- Contacts will be dynamically inserted here -->
    </div>
</div>

<!-- View Contact Modal -->
<div class="modal fade" id="viewContactModal" tabindex="-1" role="dialog" aria-labelledby="viewContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewContactModalLabel">View Contact</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body view-card" id="viewContactDetails">
                <!-- Contact details will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button class="btn btn-primary btn-view" data-id="${contact.id}" data-toggle="modal" data-target="#editContactModal">Edit</button>
                <button type="button" class="btn btn-danger" id="deleteContactButton">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Contact Modal -->
<div class="modal fade" id="editContactModal" tabindex="-1" role="dialog" aria-labelledby="editContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editContactModalLabel">Edit Contact</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="editContactForm">
                <div class="modal-body">
                    <input type="hidden" id="editContactId">
                    <!-- Form fields for editing -->
                    <div class="form-group">
                        <label for="editName">Name</label>
                        <input type="text" class="form-control" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label for="editNumber">Phone</label>
                        <input type="text" class="form-control" id="editNumber">
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input type="email" class="form-control" id="editEmail">
                    </div>
                    <div class="form-group">
                        <label for="editAddress">Address</label>
                        <input type="text" class="form-control" id="editAddress">
                    </div>
                    <div class="form-group">
                        <label for="editPhotoUrl">Photo URL</label>
                        <input type="text" class="form-control" id="editPhotoUrl">
                    </div>
                    <div class="form-group">
                        <label for="editBirthday">Birthday</label>
                        <input type="date" class="form-control" id="editBirthday">
                    </div>
                    <div class="form-group">
                        <label for="editNickname">Nickname</label>
                        <input type="text" class="form-control" id="editNickname">
                    </div>
                    <div class="form-group">
                        <label for="editRelationship">Relationship</label>
                        <input type="text" class="form-control" id="editRelationship">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveEditContactButton">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Contact Modal -->
<div class="modal fade" id="addContactModal" tabindex="-1" role="dialog" aria-labelledby="addContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document"> <!-- Reduced modal size -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addContactModalLabel">Add Contact</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="addContactForm" novalidate>
                <div class="modal-body">
                    <!-- Form fields for adding -->
                    <div class="form-group">
                        <label for="addName">Name</label>
                        <input type="text" class="form-control" id="addName" required minlength="3" maxlength="100" placeholder="Name must be between 3 and 100 characters.">
                    </div>
                    <div class="form-group">
                        <label for="addNumber">Phone</label>
                        <input type="text" class="form-control" id="addNumber" required pattern="\d{10}" placeholder="Phone number must be 10 digits.">
                    </div>

                    <div class="form-group">
                        <label for="addEmail">Email</label>
                        <input type="email" class="form-control" id="addEmail" required maxlength="100" placeholder="Please provide a valid email (max 100 characters)">
                    </div>
                    <div class="form-group">
                        <label for="addAddress">Address</label>
                        <input type="text" class="form-control" id="addAddress" maxlength="255" placeholder="Address cannot exceed 255 characters.">
                    </div>
                    <div class="form-group">
                        <label for="addPhotoUrl">Photo URL</label>
                        <input type="text" class="form-control" id="addPhotoUrl" placeholder="Please provide a valid URL.">
                    </div>
                    <div class="form-group">
                        <label for="addBirthday">Birthday</label>
                        <input type="date" class="form-control" id="addBirthday"  placeholder="Please provide a valid birthday.">
                    </div>
                    <div class="form-group">
                        <label for="addNickname">Nickname</label>
                        <input type="text" class="form-control" id="addNickname" maxlength="25" placeholder="Nickname cannot exceed 25 characters.">
                    </div>
                    <div class="form-group">
                        <label for="addRelationship">Relationship</label>
                        <input type="text" class="form-control" id="addRelationship" maxlength="25" placeholder="Relationship cannot exceed 25 characters">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="saveAddContactButton">Save Contact</button>
                    <button type="button" class="btn btn-secondary" id="clearAddContactButton">Clear</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!--Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this contact? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDeleteButton">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
    <div class="modal-content">
        <h3>Contact Added Successfully!</h3>
        <p>The contact has been added to your list.</p>
        <button id="okButton">OK</button>
    </div>
</div>

<!-- close Modal -->
<div id="closeModal" class="modal">
    <div class="modal-content">
        <h3>Error in adding contact!</h3>
        <p>Can not add contact, fill valid details.</p>
        <button id="closeButton">OK</button>
    </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3>Contact Deleted!</h3>
        <p>Contact Deleted Successfully. </p>
        <button id="deleteButton">OK</button>
    </div>
</div>

<script>
/*
    // Fetch and display contacts
    function fetchContacts() {
        $.ajax({
            url: '/api/contacts/getAllContacts',
            method: 'GET',
            success: function(data) {
                const contactList = $('#contactList');
                contactList.empty();
                data.forEach(contact => {
                    const contactCard = `
                        <div class="col-md-4">
                            <div class="contact-card">
                                <img src="${contact.photoUrl || 'https://via.placeholder.com/100'}" alt="${contact.name}">
                                <h4>${contact.name}</h4>
                                <p><strong>Phone:</strong> ${contact.number || 'N/A'}</p>
                                <p><strong>Email:</strong> ${contact.email || 'N/A'}</p>
                                <button class="btn btn-primary btn-view" data-id="${contact.id}" data-toggle="modal" data-target="#viewContactModal">View</button>
                            </div>
                        </div>
                    `;
                    contactList.append(contactCard);
                });
            }
        });
    }

    fetchContacts();

    // Search contacts
  /!*  function searchContacts() {
        const searchTerm = $('#searchBox').val();
        const searchCriteria = $('#searchSelect').val();

        $.ajax({
            url: `/api/contacts/search?${searchCriteria}=${searchTerm}`,
            method: 'GET',
            success: function(data) {
                const contactList = $('#contactList');
                contactList.empty();
                data.forEach(contact => {
                    const contactCard = `
                        <div class="col-md-4">
                            <div class="contact-card">
                                <img src="${contact.photoUrl || 'https://via.placeholder.com/100'}" alt="${contact.name}">
                                <h4>${contact.name}</h4>
                                <p><strong>Phone:</strong> ${contact.number || 'N/A'}</p>
                                <p><strong>Email:</strong> ${contact.email || 'N/A'}</p>
                                <button class="btn btn-primary btn-view" data-id="${contact.id}" data-toggle="modal" data-target="#viewContactModal">View</button>
                            </div>
                        </div>
                    `;
                    contactList.append(contactCard);
                });
            }
        });
    }*!/
    //new search

    // Base URL for API
    const apiBaseUrl = '/api/contacts/search';

    // Function to fetch contacts by name
    function searchContactsByName(name) {
        fetch(`${apiBaseUrl}/findByName/${encodeURIComponent(name)}`)
            .then(response => response.json())
            .then(data => {
                displayContacts(data);
            })
            .catch(error => {
                console.error('Error fetching contacts by name:', error);
            });
    }

    // Function to fetch contacts by nickname
    function searchContactsByNickname(nickname) {
        fetch(`${apiBaseUrl}/findByNickname/${encodeURIComponent(nickname)}`)
            .then(response => response.json())
            .then(data => {
                displayContacts(data);
            })
            .catch(error => {
                console.error('Error fetching contacts by nickname:', error);
            });
    }

    // Function to handle search form submission
    function handleSearch() {
        const criteria = document.getElementById('searchCriteria').value;
        const query = document.getElementById('searchQuery').value.trim();

        switch (criteria) {
            case 'name':
                searchContactsByName(query);
                break;
            case 'nickname':
                searchContactsByNickname(query);
                break;
            default:
                console.warn('Invalid search criteria');
                break;
        }
    }

    // Event listener for search form submission
    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission
        handleSearch();
    });


    // View contact details and open Edit and Delete modals
    $('#contactList').on('click', '.btn-view', function() {
        const contactId = $(this).data('id');

        $.ajax({
            url: `api/contacts/getContactsById/${contactId}`, // Replace with actual endpoint
            method: 'GET',
            success: function(contact) {
                $('#viewContactDetails').html(`
                <img src="${contact.photoUrl || 'https://via.placeholder.com/100'}" alt="${contact.name}" class="img-fluid mb-3">
                <div class="form-group">
                    <label for="viewName">Name</label>
                    <input type="text" class="form-control" id="viewName" value="${contact.name}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewNumber">Number</label>
                    <input type="text" class="form-control" id="viewNumber" value="${contact.number || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewEmail">Email</label>
                    <input type="text" class="form-control" id="viewEmail" value="${contact.email || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewAddress">Address</label>
                    <input type="text" class="form-control" id="viewAddress" value="${contact.address || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewBirthday">Birthday</label>
                    <input type="text" class="form-control" id="viewBirthday" value="${contact.birthday || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewNickname">Nickname</label>
                    <input type="text" class="form-control" id="viewNickname" value="${contact.nickname || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewRelationship">Relationship</label>
                    <input type="text" class="form-control" id="viewRelationship" value="${contact.relationship || 'N/A'}" readonly>
                </div>

            `);

                $('#saveEditContactButton').data('id', contact.id);
            }
        });
    });


   /!* // Add new contact
    $('#saveAddContactButton').on('click', function() {
        const newContactData = {
            name: $('#addName').val(),
            number: $('#addNumber').val(),
            email: $('#addEmail').val(),
            address: $('#addAddress').val(),
            photoUrl: $('#addPhotoUrl').val(),
            birthday: $('#addBirthday').val(),
            nickname: $('#addNickname').val(),
            relationship: $('#addRelationship').val(),
        };
        $.ajax({
            url: '/api/contacts/addContact',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(newContactData),
            success: function() {
                $('#addContactModal').modal('hide');
                fetchContacts();
            }
        });
    });
*!/
    // Clear Add Contact form
    $('#clearAddContactButton').on('click', function() {
        $('#addContactForm')[0].reset();
    });


    // new edit code
    // edit.js

    $(document).ready(function() {
        // Load contact data into the edit form when the edit button is clicked
        $('#contactList').on('click', '.btn-view', function() {
            const contactId = $(this).data('id');

            // Fetch contact details
            $.ajax({
                url: `/api/contacts/getContactsById/${contactId}`,
                method: 'GET',
                success: function(contact) {
                    // Populate form fields with contact data
                    $('#editName').val(contact.name || '');
                    $('#editNumber').val(contact.number || '');
                    $('#editEmail').val(contact.email || '');
                    $('#editAddress').val(contact.address || '');
                    $('#editPhotoUrl').val(contact.photoUrl || '');
                    $('#editBirthday').val(contact.birthday || '');
                    $('#editNickname').val(contact.nickname || '');
                    $('#editRelationship').val(contact.relationship || '');

                    // Store the contact ID for later use
                    $('#saveEditContactButton').data('id', contact.id);
                }
            });
        });

        // Save updated contact data
        $('#saveEditContactButton').on('click', function() {
            const contactId = $(this).data('id');
            const contactData = {
                name: $('#editName').val(),
                number: $('#editNumber').val(),
                email: $('#editEmail').val(),
                address: $('#editAddress').val(),
                photoUrl: $('#editPhotoUrl').val(),
                birthday: $('#editBirthday').val(),
                nickname: $('#editNickname').val(),
                relationship: $('#editRelationship').val(),
            };

            // Send updated contact data to the backend
            $.ajax({
                url: `/api/contacts/updateContact/${contactId}`,
                method: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(contactData),
                success: function() {
                    // Hide the edit modal and refresh contact list
                    $('#editContactModal').modal('hide');
                    fetchContacts(); // Call the function to refresh the contact list
                }
            });
        });
    });

//     delete

    // Delete contact
    $('#viewContactModal').on('click', '#deleteContactButton', function() {
        const contactId = $('#saveEditContactButton').data('id');

        // Show confirmation popup
        $('#deleteConfirmationModal').modal('show');

        $('#confirmDeleteButton').on('click', function() {
            $.ajax({
                url: `/api/contacts/deleteContact/${contactId}`,
                method: 'DELETE',
                success: function() {
                    $('#deleteConfirmationModal').modal('hide');
                    $('#viewContactModal').modal('hide');
                    fetchContacts();
                }
            });
        });

        $('#cancelDeleteButton').on('click', function() {
            $('#deleteConfirmationModal').modal('hide');
        });
    });


   /!* // add cont

    // Function to add a new contact
    document.getElementById('saveAddContactButton').addEventListener('click', async () => {
        const newContact = {
            name: document.getElementById('addName').value,
            number: document.getElementById('addNumber').value,
            email: document.getElementById('addEmail').value,
            address: document.getElementById('addAddress').value,
            photoUrl: document.getElementById('addPhotoUrl').value,
            birthday: document.getElementById('addBirthday').value,
            nickname: document.getElementById('addNickname').value,
            relationship: document.getElementById('addRelationship').value,
        };

        try {
            const response = await fetch(`${BASE_URL}/addContact`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newContact)
            });

            if (response.ok) {
                alert('Contact added successfully');
                $('#addContactModal').modal('hide');
                fetchContacts();
            } else {
                console.error('Failed to add contact');
            }
        } catch (error) {
            console.error('Error adding contact:', error);
        }
    });
*!/



   // ================================= FRESH Code =========
    //Add contact
    document.getElementById("saveAddContactButton").addEventListener("click", function (event) {
        event.preventDefault(); // Prevent form submission

        // Get form data
        const contact = {
            name: document.getElementById("addName").value,
            primaryPhoneNumber: document.getElementById("addNumber").value,
            primaryEmailAddress: document.getElementById("addEmail").value,
            address: document.getElementById("addAddress").value,
            photoUrl: document.getElementById("addPhotoUrl").value,
            birthday: document.getElementById("addBirthday").value,
            nickname: document.getElementById("addNickname").value,
            relationship: document.getElementById("addRelationship").value
        };

        // Validate form (ensure name and email are filled)
        if (!contact.name || !contact.primaryEmailAddress) {
            alert("Name and Email are required.");
            return;
        }

        // Make API request to add contact
        fetch('api/contacts/addContact', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(contact)
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to add contact.');
                }
            })
            .then(data => {
                alert('Contact added successfully!');
                // Optionally close modal or reset form
                $('#addContactModal').modal('hide');
                document.getElementById("addContactForm").reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding contact: ' + error.message);
            });
    });

    // Clear button functionality
    document.getElementById("clearAddContactButton").addEventListener("click", function () {
        document.getElementById("addContactForm").reset();
    });
*/

//==============############=====================#####################===========================


// Base URL for the API
const apiBaseUrl = '/contacts';

// Add Contact
document.getElementById('saveAddContactButton').addEventListener('click', function () {
    console.log(document.getElementById('addName').value);
    const contact = {
        name: document.getElementById('addName').value,
        number: document.getElementById('addNumber').value,
        email: document.getElementById('addEmail').value,
        address: document.getElementById('addAddress').value,
        photoUrl: document.getElementById('addPhotoUrl').value,
        birthday: document.getElementById('addBirthday').value,
        nickname: document.getElementById('addNickname').value,
        relationship: document.getElementById('addRelationship').value
    };

    fetch(`${apiBaseUrl}/addContact`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(contact)
    }).then(response => {
        if (!response.ok) {
            return response.text().then(text => {
                throw new Error(text);
            });
        }
        return response.json();
    })
        .then(data => {
            console.log('Success:', data);
            $('#addContactModal').modal('hide');
            // Show the success popup
            showSuccessPopup();
            // Reload contact list
            loadContacts();
        })
        .catch(error => {
            console.error('Error:', error);
            $('#addContactModal').modal('hide');
            showErrorPopup();
            loadContacts();
        });
});

// Function to show the success popup
function showSuccessPopup() {
    const modal = document.getElementById('successModal');
    const okButton = document.getElementById('okButton');

    // Display the modal
    modal.style.display = 'block';

    // Close the modal when user clicks the close button or OK button
    closeButton.onclick = function() {
        modal.style.display = 'none';
    }

    okButton.onclick = function() {
        modal.style.display = 'none';
    }

    // Close the modal when user clicks outside of the modal content
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
}
// Function to show the error popup
function showErrorPopup() {
    const modal = document.getElementById('closeModal');
    const okButton = document.getElementById('closeButton');

    // Display the modal
    modal.style.display = 'block';

    // Close the modal when user clicks the close button or OK button
    closeButton.onclick = function() {
        modal.style.display = 'none';
    }

    okButton.onclick = function() {
        modal.style.display = 'none';
    }

    // Close the modal when user clicks outside of the modal content
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
}


// Clear Add Contact Form
document.getElementById('clearAddContactButton').addEventListener('click', function () {
    document.getElementById('addContactForm').reset();
});

// Load all contacts
function loadContacts() {
    fetch(`${apiBaseUrl}/getAllContacts`)
        .then(response => response.json())
        .then(data => {
            const contactList = document.getElementById('contactList');
            contactList.innerHTML = ''; // Clear existing contacts
            data.forEach(contact => {
                const contactCard = `
                     <div class="col-md-4">
                            <div class="contact-card">
                                <img src="${contact.photoUrl || 'https://via.placeholder.com/100'}" alt="${contact.name}">
                                <h4>${contact.name}</h4>
                                <p><strong>Phone:</strong> ${contact.number || 'N/A'}</p>
                                <p><strong>Email:</strong> ${contact.email || 'N/A'}</p>
                                 <button class="btn btn-primary btn-view" onclick="viewContact(${contact.id})">View</button
                            </div>
                        </div>

                `;
                contactList.innerHTML += contactCard;
            });
        })
        .catch(error => console.error('Error:', error));
}

// View Contact
function viewContact(contactId) {
    fetch(`${apiBaseUrl}/getContactsById/${contactId}`)
        .then(response => response.json())
        .then(contact => {
            const viewContactDetails = `
                <img src="${contact.photoUrl || 'https://via.placeholder.com/100'}" alt="${contact.name}" class="img-fluid mb-3">
                <div class="form-group">
                    <label for="viewName">Name</label>
                    <input type="text" class="form-control" id="viewName" value="${contact.name}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewNumber">Number</label>
                    <input type="text" class="form-control" id="viewNumber" value="${contact.number || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewEmail">Email</label>
                    <input type="text" class="form-control" id="viewEmail" value="${contact.email || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewAddress">Address</label>
                    <input type="text" class="form-control" id="viewAddress" value="${contact.address || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewBirthday">Birthday</label>
                    <input type="text" class="form-control" id="viewBirthday" value="${contact.birthday || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewNickname">Nickname</label>
                    <input type="text" class="form-control" id="viewNickname" value="${contact.nickname || 'N/A'}" readonly>
                </div>
                <div class="form-group">
                    <label for="viewRelationship">Relationship</label>
                    <input type="text" class="form-control" id="viewRelationship" value="${contact.relationship || 'N/A'}" readonly>
                </div>
            `;
            document.getElementById('viewContactDetails').innerHTML = viewContactDetails;

            document.getElementById('deleteContactButton').setAttribute('onclick', `confirmDelete(${contact.id})`);
            $('#viewContactModal').modal('show');

        })
        .catch(error => console.error('Error:', error));
}

// Edit Contact
document.getElementById('saveEditContactButton').addEventListener('click', function () {
    const contactId = document.getElementById('editContactId').value;
    const updatedContact = {
        name: document.getElementById('editName').value,
        phone: document.getElementById('editNumber').value,
        email: document.getElementById('editEmail').value,
        address: document.getElementById('editAddress').value,
        photoUrl: document.getElementById('editPhotoUrl').value,
        birthday: document.getElementById('editBirthday').value,
        nickname: document.getElementById('editNickname').value,
        relationship: document.getElementById('editRelationship').value
    };

    fetch(`${apiBaseUrl}/updateContact/${contactId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(updatedContact)
    }).then(response => response.json())
        .then(data => {
            console.log('Updated successfully:', data);
            $('#editContactModal').modal('hide');
            loadContacts(); // Reload contacts list
        }).catch(error => console.error('Error:', error));
});

//load edit contact
function loadEditContact(contactId) {
    fetch(`${apiBaseUrl}/getContactsById/${contactId}`)
        .then(response => response.json())
        .then(contact => {
            document.getElementById('editContactId').value = contact.id;
            document.getElementById('editName').value = contact.name;
            document.getElementById('editNumber').value = contact.number || '';
            document.getElementById('editEmail').value = contact.email || '';
            document.getElementById('editAddress').value = contact.address || '';
            document.getElementById('editPhotoUrl').value = contact.photoUrl || '';
            document.getElementById('editBirthday').value = contact.birthday || '';
            document.getElementById('editNickname').value = contact.nickname || '';
            document.getElementById('editRelationship').value = contact.relationship || '';
            $('#editContactModal').modal('show');
        })
        .catch(error => console.error('Error:', error));
}


//Search contacts
f/*unction searchContacts() {
    const searchType = document.getElementById('searchSelect').value;
    const searchValue = document.getElementById('searchBox').value;

    let endpoint = '';

    // Determine the correct endpoint based on the search type
    switch (searchType) {
        case 'name':
            endpoint = `/search/findByName/${searchValue}`;
            break;
        case 'email':
            endpoint = `/search/findByEmail/${searchValue}`;
            break;
        case 'phone':
            endpoint = `/search/findByNumber/${searchValue}`;
            break;
        case 'nickname':
            endpoint = `/search/findByNickname/${searchValue}`;
            break;
        case 'birthday':
            endpoint = `/search/birthday/${searchValue}`;
            break;
        case 'relationship':
            endpoint = `/search/relationship/${searchValue}`;
            break;
        case 'address':
            endpoint = `/search/address/${searchValue}`;
            break;
        default:
            console.error('Invalid search type');
            return;
    }

    fetch(`${apiBaseUrl}${endpoint}`)
        .then(response => response.json())
        .then(data => {
            const contactList = document.getElementById('contactList');
            contactList.innerHTML = ''; // Clear existing contacts

            if (data.length === 0) {
                contactList.innerHTML = '<p>No contacts found</p>';
                return;
            }

            data.forEach(contact => {
                const contactCard = `
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <img class="card-img-top" src="${contact.photoUrl || 'default-image.png'}" alt="Contact Photo">
                            <div class="card-body">
                                <h5 class="card-title">${contact.name}</h5>
                                <p class="card-text">Phone: ${contact.primaryPhoneNumber || 'N/A'}</p>
                                <p class="card-text">Email: ${contact.primaryEmailAddress || 'N/A'}</p>
                                <button class="btn btn-primary" onclick="viewContact(${contact.id})">View</button>
                            </div>
                        </div>
                    </div>
                `;
                contactList.innerHTML += contactCard;
            });
        })
        .catch(error => console.error('Error:', error));
}
*/
// Search Contacts
function searchContacts() {
    const searchType = document.getElementById('searchSelect').value;
    const searchValue = document.getElementById('searchBox').value;

    fetch(`${apiBaseUrl}/search/findBy${capitalize(searchType)}/${encodeURIComponent(searchValue)}`)
        .then(response => {
            console.log('Response Status:', response.status); // Log status
            return response.text(); // Read response as text first
        })
        .then(text => {
            console.log('Response Text:', text); // Log raw response text
            try {
                const data = JSON.parse(text); // Attempt to parse JSON
                const contactList = document.getElementById('contactList');
                contactList.innerHTML = ''; // Clear existing contacts
                data.forEach(contact => {
                    const contactCard = `
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <img class="card-img-top" src="${contact.photoUrl || 'default-image.png'}" alt="Contact Photo">
                                <div class="card-body">
                                    <h5 class="card-title">${contact.name}</h5>
                                    <p class="card-text">Phone: ${contact.phone}</p>
                                    <p class="card-text">Email: ${contact.email}</p>
                                    <button class="btn btn-primary" onclick="viewContact(${contact.id})">View</button>
                                </div>
                            </div>
                        </div>
                    `;
                    contactList.innerHTML += contactCard;
                });
            } catch (error) {
                console.error('Error parsing JSON:', error);
            }
        })
        .catch(error => console.error('Error fetching data:', error));
}

function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// Delete Contact
function confirmDelete(contactId) {
    $('#deleteConfirmationModal').modal('show');
    document.getElementById('confirmDeleteButton').setAttribute('onclick', `deleteContact(${contactId})`);
    $('#cancelDeleteButton').on('click', function() {
        $('#deleteConfirmationModal').modal('hide');
    });
}

function deleteContact(contactId) {
    fetch(`${apiBaseUrl}/deleteContact/${contactId}`, {
        method: 'DELETE'
    }).then(() => {
        $('#viewContactModal').modal('hide');
        console.log('Deleted successfully');
        $('#deleteConfirmationModal').modal('hide');
        showDeletePopup();
        loadContacts(); // Reload contact list after deletion
    }).catch(error => console.error('Error:', error));

}

function showDeletePopup() {
    const modal = document.getElementById('deleteModal');
    const okButton = document.getElementById('deleteButton');

    // Display the modal
    modal.style.display = 'block';

    // Close the modal when user clicks the close button or OK button
    closeButton.onclick = function() {
        modal.style.display = 'none';
    }

    okButton.onclick = function() {
        modal.style.display = 'none';
    }

    // Close the modal when user clicks outside of the modal content
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
}

// On page load, fetch and display contacts
document.addEventListener('DOMContentLoaded', function () {
    loadContacts();
});

</script>
</body>
</html>
