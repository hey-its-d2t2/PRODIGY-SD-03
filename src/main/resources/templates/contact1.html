<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Management</title>
    <link href="/Styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="#">Contact Manager</a>
    <a class="btn btn-light ml-auto" href="#" data-toggle="modal" data-target="#addContactModal">Add Contact</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <form method="get" action="#" th:action="@{/api/contacts/name/findByFirstName/}" class="form-inline ml-auto">
            <select name="searchBy" class="form-control mr-2">
                <option value="firstName">First Name</option>
                <option value="middleName">Middle Name</option>
                <option value="lastName">Last Name</option>
                <option value="nickname">Nickname</option>
                <option value="email">Email</option>
                <option value="phone">Phone</option>
            </select>
            <input type="text" name="search" placeholder="Search Contacts..." class="form-control mr-2" />
            <button type="submit" class="btn btn-light">Search</button>
        </form>
    </div>
</nav>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <h2 class="text-center">Contacts</h2>
            <div class="row">
                <div class="col-md-4 mb-4" th:each="contact : ${contacts}">
                    <div class="contact-card">
                        <img th:src="@{${contact.photoUrl}}" alt="Contact Photo">
                        <div class="contact-info">
                            <h5 th:text="${contact.firstName} + ' ' + ${contact.middleName} + ' ' + ${contact.lastName}"></h5>
                            <p th:text="${contact.company}"></p>
                            <p th:text="${contact.jobTitle}"></p>
                            <p th:text="${contact.primaryEmailAddress}"></p>
                        </div>
                        <button type="button" class="btn btn-info btn-block mt-3" data-toggle="modal" data-target="#contactModal" th:data-contact-id="${contact.id}">View</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--
 Modal for contact details
<div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactModalLabel">Contact Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="contactDetails">
                &lt;!&ndash; Contact details will be loaded here &ndash;&gt;
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" id="updateButton" class="btn btn-warning">Update</button>
                <button type="button" id="deleteButton" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
-->
<!-- Modal for contact details -->
<div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactModalLabel">Contact Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="contactDetails">
                <!-- Contact details will be dynamically loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" id="updateButton" class="btn btn-warning">Update</button>
                <button type="button" id="deleteButton" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this contact?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" id="confirmDeleteButton" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Contact Modal -->
<div class="modal fade" id="addContactModal" tabindex="-1" role="dialog" aria-labelledby="addContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addContactModalLabel">Add New Contact</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addContactForm" method="post" action="/api/contacts/addContact">
                    <!-- form fields... -->
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" name="firstName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="middleName">Middle Name</label>
                        <input type="text" id="middleName" name="middleName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="lastName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="primaryEmailAddress">Primary Email Address</label>
                        <input type="email" id="primaryEmailAddress" name="primaryEmailAddress" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="secondaryEmailAddress">Secondary Email Address</label>
                        <input type="email" id="secondaryEmailAddress" name="secondaryEmailAddress" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="primaryPhoneNumber">Primary Phone Number</label>
                        <input type="tel" id="primaryPhoneNumber" name="primaryPhoneNumber" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="secondaryPhoneNumber">Secondary Phone Number</label>
                        <input type="tel" id="secondaryPhoneNumber" name="secondaryPhoneNumber" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" name="address" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="company">Company</label>
                        <input type="text" id="company" name="company" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="jobTitle">Job Title</label>
                        <input type="text" id="jobTitle" name="jobTitle" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" name="notes" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="photoUrl">Photo URL</label>
                        <input type="text" id="photoUrl" name="photoUrl" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="website">Website</label>
                        <input type="text" id="website" name="website" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="birthday">Birthday</label>
                        <input type="date" id="birthday" name="birthday" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="nickname">Nickname</label>
                        <input type="text" id="nickname" name="nickname" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="relationship">Relationship</label>
                        <input type="text" id="relationship" name="relationship" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="label">Label</label>
                        <input type="text" id="label" name="label" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="department">Department</label>
                        <input type="text" id="department" name="department" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="officeLocation">Office Location</label>
                        <input type="text" id="officeLocation" name="officeLocation" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="language">Language</label>
                        <input type="text" id="language" name="language" class="form-control">
                    </div>
                    <div class="form-group text-center">
                        <button type="submit" class="btn btn-primary">Add Contact</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="reset" class="btn btn-warning">Clear</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
   /* $(document).ready(function() {
        // Handle View button click
        $('#contactModal').on('show.bs.modal', function(event) {
            var button = $(event.relatedTarget);
            var contactId = button.data('contact-id');
            $.get('/api/contacts/getContactsById/' + contactId, function(contact) {
                var detailsHtml = '<div class="form-group"><label>First Name</label><p>' + contact.firstName + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Middle Name</label><p>' + contact.middleName + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Last Name</label><p>' + contact.lastName + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Primary Email Address</label><p>' + contact.primaryEmailAddress + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Secondary Email Address</label><p>' + contact.secondaryEmailAddress + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Primary Phone Number</label><p>' + contact.primaryPhoneNumber + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Secondary Phone Number</label><p>' + contact.secondaryPhoneNumber + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Address</label><p>' + contact.address + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Company</label><p>' + contact.company + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Job Title</label><p>' + contact.jobTitle + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Notes</label><p>' + contact.notes + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Photo URL</label><p><img src="' + contact.photoUrl + '" alt="Photo" class="img-fluid"></p></div>';
                detailsHtml += '<div class="form-group"><label>Website</label><p>' + contact.website + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Birthday</label><p>' + contact.birthday + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Nickname</label><p>' + contact.nickname + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Relationship</label><p>' + contact.relationship + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Label</label><p>' + contact.label + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Department</label><p>' + contact.department + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Office Location</label><p>' + contact.officeLocation + '</p></div>';
                detailsHtml += '<div class="form-group"><label>Language</label><p>' + contact.language + '</p></div>';
                $('#contactDetails').html(detailsHtml);
            });
        });*/
   /*$(document).ready(function() {
       // Handle View button click
       $('#contactModal').on('show.bs.modal', function(event) {
           var button = $(event.relatedTarget);
           var contactId = button.data('contact-id');

           // Fetch contact details using Ajax
           $.get('/api/contacts/getContactsById/' + contactId, function(contact) {
               var detailsHtml = `
                    <div class="form-group">
                        <label>First Name:</label>
                        <p>${contact.firstName}</p>
                    </div>
                    <div class="form-group">
                        <label>Middle Name:</label>
                        <p>${contact.middleName}</p>
                    </div>
                    <div class="form-group">
                        <label>Last Name:</label>
                        <p>${contact.lastName}</p>
                    </div>
                    <div class="form-group">
                        <label>Primary Email Address:</label>
                        <p>${contact.primaryEmailAddress}</p>
                    </div>
                    <div class="form-group">
                        <label>Secondary Email Address:</label>
                        <p>${contact.secondaryEmailAddress}</p>
                    </div>
                    <div class="form-group">
                        <label>Primary Phone Number:</label>
                        <p>${contact.primaryPhoneNumber}</p>
                    </div>
                    <div class="form-group">
                        <label>Secondary Phone Number:</label>
                        <p>${contact.secondaryPhoneNumber}</p>
                    </div>
                    <div class="form-group">
                        <label>Company:</label>
                        <p>${contact.company}</p>
                    </div>
                    <div class="form-group">
                        <label>Job Title:</label>
                        <p>${contact.jobTitle}</p>
                    </div>
                    <div class="form-group">
                        <label>Notes:</label>
                        <p>${contact.notes}</p>
                    </div>
                    <div class="form-group">
                        <label>Address:</label>
                        <p>${contact.address}</p>
                    </div>
                    <div class="form-group">
                        <label>Photo:</label>
                        <p><img src="${contact.photoUrl}" alt="Photo" class="img-fluid"></p>
                    </div>
                `;

               $('#contactDetails').html(detailsHtml);
           });
       });
   });*/
   $(document).ready(function() {
       // Handle View button click
       $('#contactModal').on('show.bs.modal', function(event) {
           var button = $(event.relatedTarget);
           var contactId = button.data('contact-id');

           // Fetch contact details using the API
           $.get('/api/contacts/getContactsById/' + contactId, function(contact) {
               var detailsHtml = `
                <div class="form-group">
                    <label>First Name</label>
                    <p>${contact.firstName}</p>
                </div>
                <div class="form-group">
                    <label>Middle Name</label>
                    <p>${contact.middleName ? contact.middleName : 'N/A'}</p>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <p>${contact.lastName}</p>
                </div>
                <div class="form-group">
                    <label>Primary Email Address</label>
                    <p>${contact.primaryEmailAddress}</p>
                </div>
                <div class="form-group">
                    <label>Secondary Email Address</label>
                    <p>${contact.secondaryEmailAddress ? contact.secondaryEmailAddress : 'N/A'}</p>
                </div>
                <div class="form-group">
                    <label>Primary Phone Number</label>
                    <p>${contact.primaryPhoneNumber}</p>
                </div>
                <div class="form-group">
                    <label>Secondary Phone Number</label>
                    <p>${contact.secondaryPhoneNumber ? contact.secondaryPhoneNumber : 'N/A'}</p>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <p>${contact.address}</p>
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <p>${contact.company}</p>
                </div>
                <div class="form-group">
                    <label>Job Title</label>
                    <p>${contact.jobTitle}</p>
                </div>
                <div class="form-group">
                    <label>Birthday</label>
                    <p>${contact.birthday}</p>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <p>${contact.notes}</p>
                </div>
                <div class="form-group">
                    <label>Website</label>
                    <p><a href="${contact.website}" target="_blank">${contact.website}</a></p>
                </div>
            `;

               // Update modal with contact details
               $('#contactDetails').html(detailsHtml);
           });
       });
   });

        // Handle Update button click
        $('#updateButton').click(function() {
            // Open update form in modal
            var contactId = $('#contactModal').find('button[data-contact-id]').data('contact-id');
            $.get('/api/contacts/getContactsById/' + contactId, function(contact) {
                // Populate form fields in update modal
                $('#addContactModal #firstName').val(contact.firstName);
                $('#addContactModal #middleName').val(contact.middleName);
                $('#addContactModal #lastName').val(contact.lastName);
                $('#addContactModal #primaryEmailAddress').val(contact.primaryEmailAddress);
                $('#addContactModal #secondaryEmailAddress').val(contact.secondaryEmailAddress);
                $('#addContactModal #primaryPhoneNumber').val(contact.primaryPhoneNumber);
                $('#addContactModal #secondaryPhoneNumber').val(contact.secondaryPhoneNumber);
                $('#addContactModal #address').val(contact.address);
                $('#addContactModal #company').val(contact.company);
                $('#addContactModal #jobTitle').val(contact.jobTitle);
                $('#addContactModal #notes').val(contact.notes);
                $('#addContactModal #photoUrl').val(contact.photoUrl);
                $('#addContactModal #website').val(contact.website);
                $('#addContactModal #birthday').val(contact.birthday);
                $('#addContactModal #nickname').val(contact.nickname);
                $('#addContactModal #relationship').val(contact.relationship);
                $('#addContactModal #label').val(contact.label);
                $('#addContactModal #department').val(contact.department);
                $('#addContactModal #officeLocation').val(contact.officeLocation);
                $('#addContactModal #language').val(contact.language);
                $('#addContactModal').modal('show');
            });
        });

        // Handle Delete button click
        $('#deleteButton').click(function() {
            $('#deleteConfirmationModal').modal('show');
        });

        // Confirm delete
        $('#confirmDeleteButton').click(function() {
            var contactId = $('#contactModal').find('button[data-contact-id]').data('contact-id');
            $.ajax({
                url: '/api/contacts/deleteContact/' + contactId,
                type: 'DELETE',
                success: function(result) {
                    $('#contactModal').modal('hide');
                    location.reload();
                }
            });
        });
    });
</script>

</body>
</html>
